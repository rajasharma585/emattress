<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rilaxtion Mattress – Sleep Better</title>
  <meta name="description" content="Rilaxtion Mattress – premium mattresses, pillows & bedding. Free shipping, 100-Night Trial, 10-Year Warranty."/>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root{
      --brand:#2b6cb0;          /* primary */
      --brand-2:#0ea5e9;        /* accent */
      --dark:#0f172a;           /* heading */
      --muted:#6b7280;          /* text */
      --cream:#f8fafc;          /* background */
      --star:#f59e0b;           /* rating */
    }
    body{font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--cream);color:var(--dark)}
    .shadow-soft{box-shadow:0 10px 25px rgba(2,8,23,.08);} 
    .rounded-2xl{border-radius:1.25rem!important;}

    /* Navbar */
    .navbar-brand{font-weight:800;letter-spacing:.3px;color:var(--dark)!important}
    .badge-pill{border-radius:999px}

    /* Hero */
    .hero{background:linear-gradient(135deg, #e0f2fe 0%, #fafafa 50%, #ffffff 100%);} 
    .hero-img{max-width:600px;border-radius:1.25rem; display:block; margin-left:auto; margin-right:auto; }

    /* Product Cards */
    .product-card .price{font-size:1.1rem;font-weight:700;color:var(--dark)}
    .product-card .old{color:#9ca3af;text-decoration:line-through;font-weight:500}
    .rating i{color:var(--star)}
    .wishlist{position:absolute;top:.75rem;right:.75rem}

    /* Counters */
    .counter{font-size:2rem;font-weight:800;color:var(--dark)}
    .counter-wrap{background:#fff}

    /* Footer */
    footer a{color:#64748b;text-decoration:none}
    footer a:hover{color:var(--brand)}

    .toast-container{z-index:1080}

    /* Small responsive tweaks */
    @media (max-width: 767px){
      .hero-img{max-width:360px}
    }
  </style>
</head>
<body>

<!-- Toasts -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="toast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="polite" aria-atomic="true" data-bs-autohide="true" data-bs-delay="2500">
    <div class="d-flex">
      <div class="toast-body" id="toast-body">Item added to cart.</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg bg-white sticky-top shadow-sm" aria-label="Main navigation">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <i class="bi bi-moon-stars me-2 text-primary" aria-hidden="true"></i>
      Rilaxtion <span class="ms-1 text-primary">Mattress</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="#shop">Shop</a></li>
        <li class="nav-item"><a class="nav-link" href="#why">Why Us</a></li>
        <li class="nav-item"><a class="nav-link" href="#testimonials">Reviews</a></li>
        <li class="nav-item"><a class="nav-link" href="#faq">FAQ</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
      </ul>
      <div class="d-flex ms-lg-3">
        <button class="btn btn-outline-primary me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#cart" aria-controls="cart" aria-label="Open cart">
          <i class="bi bi-bag"></i> <span class="badge bg-primary ms-1" id="cart-count">0</span>
        </button>
        <button class="btn btn-primary" type="button">Sign In</button>
      </div>
    </div>
  </div>
</nav>

<!-- HERO -->
<header class="hero py-5 py-lg-6">
  <div class="container">
    <div class="row align-items-center g-4">
      <div class="col-lg-6">
        <span class="badge text-bg-primary badge-pill mb-3">100-Night Trial • Free Shipping • 10-Year Warranty</span>
        <h1 class="display-5 fw-bold text-dark">Sleep better with <span class="text-primary">Rilaxtion</span></h1>
        <p class="lead text-secondary">Premium memory foam and hybrid mattresses engineered for India’s climate—cooler sleep, superior spine alignment, and plush comfort.</p>
        <div class="d-flex gap-2">
          <a href="#shop" class="btn btn-primary btn-lg"><i class="bi bi-bag me-1"></i> Shop Now</a>
          <a href="#why" class="btn btn-outline-primary btn-lg">Why Rilaxtion?</a>
        </div>
        <div class="d-flex align-items-center gap-2 mt-3">
          <div class="rating" aria-label="rating 4.8">
            <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-half"></i>
          </div>
          <small class="text-muted">4.8/5 from 3,200+ happy sleepers</small>
        </div>
      </div>
      <div class="col-lg-6 text-center">
        <!-- Use your hosted image URL here instead of the Unsplash placeholder -->
        <img class="img-fluid hero-img shadow-soft" alt="Rilaxtion mattress on a modern bed" src="headingimage.jpg" loading="lazy">
      </div>
    </div>
  </div>
</header>

<!-- USP STRIP -->
<section id="why" class="py-4">
  <div class="container">
    <div class="row g-3">
      <div class="col-6 col-lg-3">
        <div class="p-3 bg-white rounded-2xl shadow-soft h-100 d-flex align-items-center gap-3"><i class="bi bi-truck fs-3 text-primary" aria-hidden="true"></i> <div><div class="fw-bold">Free & Fast Delivery</div><small class="text-muted">Across major cities</small></div></div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="p-3 bg-white rounded-2xl shadow-soft h-100 d-flex align-items-center gap-3"><i class="bi bi-arrow-repeat fs-3 text-primary" aria-hidden="true"></i> <div><div class="fw-bold">100-Night Trial</div><small class="text-muted">Easy returns</small></div></div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="p-3 bg-white rounded-2xl shadow-soft h-100 d-flex align-items-center gap-3"><i class="bi bi-shield-check fs-3 text-primary" aria-hidden="true"></i> <div><div class="fw-bold">10-Year Warranty</div><small class="text-muted">Hassle-free</small></div></div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="p-3 bg-white rounded-2xl shadow-soft h-100 d-flex align-items-center gap-3"><i class="bi bi-thermometer-sun fs-3 text-primary" aria-hidden="true"></i> <div><div class="fw-bold">Cool Gel Foam</div><small class="text-muted">All-season comfort</small></div></div>
      </div>
    </div>
  </div>
</section>

<!-- FILTERS + PRODUCT GRID -->
<section id="shop" class="py-5">
  <div class="container">
    <div class="d-lg-flex align-items-end justify-content-between gap-3 mb-4">
      <div>
        <h2 class="fw-bold mb-1">Best Sellers</h2>
        <p class="text-muted mb-0">Choose your size, firmness & budget. COD available.</p>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <div class="input-group">
          <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
          <input id="search" class="form-control" placeholder="Search products… (e.g., hybrid, queen)" aria-label="Search products"/>
        </div>
        <select id="filter-size" class="form-select" aria-label="Filter by size">
          <option value="">Size: All</option>
          <option>Single</option>
          <option>Queen</option>
          <option>King</option>
        </select>
        <select id="filter-firm" class="form-select" aria-label="Filter by firmness">
          <option value="">Firmness: All</option>
          <option>Soft</option>
          <option>Medium</option>
          <option>Firm</option>
        </select>
        <select id="sort" class="form-select" aria-label="Sort products">
          <option value="pop">Sort: Most Popular</option>
          <option value="low">Price: Low to High</option>
          <option value="high">Price: High to Low</option>
        </select>
      </div>
    </div>

    <div id="grid" class="row g-4">
      <!-- Product items: use remote images or your hosted images -->
      <div class="col-12 col-sm-6 col-lg-4 product" data-size="Queen" data-firm="Medium" data-price="17999"
           data-id="m1" data-name="Cool Gel Memory Foam – Queen" data-img="mattress4.jpg"
           data-desc="Pressure-relieving foam with cooling gel for Indian summers." data-thickness='[6,8,10]' tabindex="0" role="button" aria-label="Open product Cool Gel Memory Foam – Queen">
        <div class="card product-card h-100 shadow-soft position-relative rounded-2xl">
          <button class="btn btn-light wishlist shadow-sm" aria-label="Add to wishlist" data-wish><i class="bi bi-heart"></i></button>
          <img class="card-img-top" alt="Cool Gel Memory Foam Mattress" src="mattress4.jpg" loading="lazy">
          <div class="card-body">
            <h5 class="card-title">Cool Gel Memory Foam – Queen</h5>
            <div class="d-flex align-items-center justify-content-between">
              <div class="price">₹17,999 <span class="old ms-1">₹22,999</span></div>
              <div class="rating" aria-hidden="true"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star"></i></div>
            </div>
            <p class="mt-2 text-muted small">Pressure-relieving foam with cooling gel for Indian summers.</p>
            <div class="d-flex gap-2">
              <button class="btn btn-primary flex-grow-1 btn-detail">Buy Now</button>
              <button class="btn btn-outline-secondary" data-quick>Quick View</button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-4 product" data-size="King" data-firm="Medium" data-price="25999"
           data-id="m2" data-name="Hybrid Pocket Spring – King" data-img="mattress1.jpg"
           data-desc="Bounce of springs + comfort of foam. Zero partner disturbance." data-thickness='[8,10,12]' tabindex="0" role="button" aria-label="Open product Hybrid Pocket Spring – King">
        <div class="card product-card h-100 shadow-soft position-relative rounded-2xl">
          <button class="btn btn-light wishlist shadow-sm" aria-label="Add to wishlist" data-wish><i class="bi bi-heart"></i></button>
          <img class="card-img-top" alt="Hybrid Pocket Spring Mattress" src="mattress1.jpg" loading="lazy">
          <div class="card-body">
            <h5 class="card-title">Hybrid Pocket Spring – King</h5>
            <div class="d-flex align-items-center justify-content-between">
              <div class="price">₹25,999 <span class="old ms-1">₹31,999</span></div>
              <div class="rating" aria-hidden="true"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-half"></i></div>
            </div>
            <p class="mt-2 text-muted small">Bounce of springs + comfort of foam. Zero partner disturbance.</p>
            <div class="d-flex gap-2">
              <button class="btn btn-primary flex-grow-1 btn-detail">Buy Now</button>
              <button class="btn btn-outline-secondary" data-quick>Quick View</button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-sm-6 col-lg-4 product" data-size="Single" data-firm="Firm" data-price="12999"
           data-id="m3" data-name="Ortho Support – Single" data-img="mattress3.jpg"
           data-desc="Firm orthopedic support recommended by physios." data-thickness='[5,6,8]' tabindex="0" role="button" aria-label="Open product Ortho Support – Single">
        <div class="card product-card h-100 shadow-soft position-relative rounded-2xl">
          <button class="btn btn-light wishlist shadow-sm" aria-label="Add to wishlist" data-wish><i class="bi bi-heart"></i></button>
          <img class="card-img-top" alt="Orthopedic Support Mattress" src="mattress3.jpg" loading="lazy">
          <div class="card-body">
            <h5 class="card-title">Ortho Support – Single</h5>
            <div class="d-flex align-items-center justify-content-between">
              <div class="price">₹12,999 <span class="old ms-1">₹16,499</span></div>
              <div class="rating" aria-hidden="true"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star"></i><i class="bi bi-star"></i></div>
            </div>
            <p class="mt-2 text-muted small">Firm orthopedic support recommended by physios.</p>
            <div class="d-flex gap-2">
              <button class="btn btn-primary flex-grow-1 btn-detail">Buy Now</button>
              <button class="btn btn-outline-secondary" data-quick>Quick View</button>
            </div>
          </div>
        </div>
      </div>
      <!-- add more products similarly... -->
    </div>
  </div>
</section>

<!-- PRODUCT DETAIL MODAL (full) -->
<div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-2xl">
      <div class="modal-header">
        <h5 id="d-title" class="modal-title">Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-4 align-items-center">
          <div class="col-md-6 text-center">
            <img id="d-img" class="img-fluid rounded" alt="Product" loading="lazy">
            <div class="mt-3">
              <small class="text-muted" id="d-desc"></small>
            </div>
          </div>
          <div class="col-md-6">
            <h4 id="d-name"></h4>
            <div class="mb-2"><span id="d-price" class="fw-bold fs-5"></span></div>

            <div class="mb-3">
              <label class="form-label small">Size</label>
              <select class="form-select mb-2" id="d-size" aria-label="Select size">
                <option>Single</option><option>Queen</option><option>King</option>
              </select>

              <label class="form-label small">Thickness (cm)</label>
              <select class="form-select mb-2" id="d-thickness" aria-label="Select thickness"></select>

              <label class="form-label small">Quantity</label>
              <div class="input-group mb-3" style="max-width:140px;">
                <button class="btn btn-outline-secondary" id="d-qty-minus" aria-label="Decrease quantity">−</button>
                <input type="text" id="d-qty" class="form-control text-center" value="1" inputmode="numeric" aria-label="Quantity" />
                <button class="btn btn-outline-secondary" id="d-qty-plus" aria-label="Increase quantity">+</button>
              </div>
            </div>

            <div class="d-flex gap-2">
              <button id="d-add" class="btn btn-primary flex-grow-1"><i class="bi bi-bag me-1"></i> Add to Cart</button>
              <button id="d-buy" class="btn btn-outline-primary flex-grow-1">Buy Now</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- QUICK VIEW (small) -->
<div class="modal fade" id="quickModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered">
    <div class="modal-content rounded-2xl">
      <div class="modal-header">
        <h5 class="modal-title" id="q-title">Product Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex gap-3">
        <img id="q-img" class="img-fluid rounded" alt="Product" style="width:140px;height:100px;object-fit:cover" loading="lazy">
        <div>
          <div class="mb-1" id="q-desc"></div>
          <div class="fw-bold" id="q-price"></div>
          <div class="mt-2">
            <button id="q-add" class="btn btn-primary btn-sm"><i class="bi bi-bag me-1"></i> Add</button>
            <button id="q-view" class="btn btn-outline-secondary btn-sm">View</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CHECKOUT / BUY NOW MODAL -->
<div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
    <div class="modal-content rounded-2xl">
      <div class="modal-header">
        <h5 class="modal-title">Checkout</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-lg-6">
            <div class="p-3 bg-white rounded-2xl shadow-soft">
              <h6>Contact Details</h6>
              <div class="row g-2">
                <div class="col-6"><input id="c-first" class="form-control" placeholder="First name" required></div>
                <div class="col-6"><input id="c-last" class="form-control" placeholder="Last name" required></div>
                <div class="col-12"><input id="c-phone" class="form-control" placeholder="Phone" required></div>
                <div class="col-12"><input id="c-email" type="email" class="form-control" placeholder="Email" required></div>
              </div>

              <hr>

              <h6>Shipping Address</h6>
              <div class="mb-2">
                <input id="addr-line" class="form-control" placeholder="Address line (street, building)"/>
              </div>
              <div class="row g-2 mb-2">
                <div class="col-6"><input id="addr-pincode" class="form-control" placeholder="Pincode"/></div>
                <div class="col-6"><input id="addr-city" class="form-control" placeholder="City/District"/></div>
              </div>
              <div class="row g-2 mb-2">
                <div class="col-6">
                  <select id="addr-state" class="form-select" aria-label="State select">
                    <option value="">Select State</option>
                  </select>
                </div>
                <div class="col-6"><input id="addr-state-code" class="form-control" placeholder="State Code (optional)"/></div>
              </div>
              <div class="d-grid gap-2">
                <button id="pincode-lookup" class="btn btn-outline-primary btn-sm">Find by Pincode</button>
                <small class="text-muted">Pincode से City, State auto-fill होगा।</small>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="p-3 bg-white rounded-2xl shadow-soft">
              <h6>Order Summary</h6>
              <ul id="checkout-items" class="list-group mb-3"></ul>
              <div class="d-flex justify-content-between fw-bold mb-3">
                <span>Total</span><span id="checkout-total">₹0</span>
              </div>
              <div class="d-grid gap-2">
                <button id="pay-now" class="btn btn-success">Pay Now</button>
                <button id="place-cod" class="btn btn-outline-secondary">Place Order (Cash on Delivery)</button>
              </div>
              <small class="text-muted d-block mt-2">यह एक demo checkout है — real gateway integrate करें।</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- OFFCANVAS CART -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="cart" aria-labelledby="cartLabel">
  <div class="offcanvas-header">
    <h5 id="cartLabel"><i class="bi bi-bag me-1"></i> Your Cart</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body d-flex flex-column">
    <ul id="cart-items" class="list-group mb-3"></ul>
    <div class="mt-auto">
      <div class="d-flex justify-content-between fw-bold mb-2">
        <span>Total</span>
        <span id="cart-total">₹0</span>
      </div>
      <div class="d-flex gap-2">
        <button id="checkout-button" class="btn btn-primary w-100" aria-label="Checkout">Checkout</button>
      </div>
    </div>
  </div>
</div>

<!-- Testimonial Section -->
<section id="testimonials" class="testimonials section-padding bg-light">
  <div class="container">
    <div class="row text-center mb-4">
      <h2 class="fw-bold">What Our Clients Say</h2>
      <p class="text-muted">Real reviews from our happy clients</p>
    </div>
    <div id="testimonialCarousel" class="carousel slide" data-bs-ride="carousel" aria-label="Customer testimonials">
      <div class="carousel-inner">

        <div class="carousel-item active text-center">
          <div class="card p-4 shadow-sm">
            <p class="mb-3">"Rilaxtion mattress ne meri नींद aur पीठ दर्द dono improve kar diya. Quality bahut acchi hai!"</p>
            <h5 class="fw-bold">Rahul Verma</h5>
            <span class="text-muted">Delhi, India</span>
          </div>
        </div>

        <div class="carousel-item text-center">
          <div class="card p-4 shadow-sm">
            <p class="mb-3">"Service fast thi aur product bilkul expected jaisa. Highly recommend!"</p>
            <h5 class="fw-bold">Priya Sharma</h5>
            <span class="text-muted">Mumbai, India</span>
          </div>
        </div>

        <div class="carousel-item text-center">
          <div class="card p-4 shadow-sm">
            <p class="mb-3">"Best mattress I have ever used. Value for money."</p>
            <h5 class="fw-bold">Amit Kumar</h5>
            <span class="text-muted">Bangalore, India</span>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<!-- Counter Section -->
<section id="counters" class="counters section-padding text-white" style="background:#0d6efd;">
  <div class="container text-center">
    <div class="row g-4">
      <div class="col-md-3">
        <h1 class="fw-bold counter" data-target="9000">0</h1>
        <p>Happy Clients</p>
      </div>
      <div class="col-md-3">
        <h1 class="fw-bold counter" data-target="12000">0</h1>
        <p>Mattress Sold</p>
      </div>
      <div class="col-md-3">
        <h1 class="fw-bold counter" data-target="110">0</h1>
        <p>City Covered</p>
      </div>
      <div class="col-md-3">
        <h1 class="fw-bold counter" data-target="10">0</h1>
        <p>Years Warranty</p>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="bg-white border-top py-4 mt-4">
  <div class="container">
    <div class="row g-3 align-items-center">
      <div class="col-md-6">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-moon-stars text-primary" aria-hidden="true"></i>
          <strong>Rilaxtion Mattress</strong>
        </div>
        <small class="text-muted">© <span id="year"></span> Rilaxtion Sleep Pvt. Ltd. All rights reserved.</small>
      </div>
      <div class="col-md-6 text-md-end">
        <a href="#" class="me-3">Privacy</a>
        <a href="#" class="me-3">Terms</a>
        <a href="#">Refund Policy</a>
      </div>
    </div>
  </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ---------------------------
   Utilities & initial state
   --------------------------- */
const fmt = n => '₹' + Number(n).toLocaleString('en-IN');
const toastEl = document.getElementById('toast');
const toast = new bootstrap.Toast(toastEl);

let cart = JSON.parse(localStorage.getItem('rx_cart')||'[]');
const save = ()=> localStorage.setItem('rx_cart', JSON.stringify(cart));

function showToast(msg){
  document.getElementById('toast-body').textContent = msg;
  toast.show();
}

/* ---------------------------
   Cart rendering & helpers
   --------------------------- */
function renderCart(){
  const list = document.getElementById('cart-items');
  list.innerHTML = '';
  let total = 0;
  cart.forEach((it, idx)=>{
    total += it.price * it.qty;
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex align-items-center justify-content-between';
    li.innerHTML = `
      <div class="d-flex align-items-center gap-3">
        <img src="${it.img}" alt="${it.name}" width="48" height="48" class="rounded" loading="lazy"/>
        <div>
          <div class="fw-semibold">${it.name}</div>
          <small class="text-muted">${fmt(it.price)} × 
            <button class='btn btn-sm btn-light border ms-1 me-1' data-minus='${idx}' aria-label="Decrease">−</button>
            <span>${it.qty}</span>
            <button class='btn btn-sm btn-light border ms-1' data-plus='${idx}' aria-label="Increase">+</button>
          </small>
        </div>
      </div>
      <div class="text-end">
        <div class="fw-bold">${fmt(it.price*it.qty)}</div>
        <button class="btn btn-sm btn-outline-danger mt-1" data-del='${idx}' aria-label="Remove"><i class="bi bi-trash"></i></button>
      </div>`;
    list.appendChild(li);
  });
  document.getElementById('cart-total').textContent = fmt(total);
  document.getElementById('cart-count').textContent = cart.reduce((a,b)=>a+b.qty,0);
}

/* Add item: merge if same id+size+thickness */
function addToCart(item){
  // ensure numeric price and qty
  item.price = Number(item.price) || 0;
  item.qty = Number(item.qty) || 1;
  const exIdx = cart.findIndex(i=>i.id===item.id && i.size===item.size && String(i.thickness)===String(item.thickness));
  if(exIdx > -1){
    cart[exIdx].qty += item.qty;
  } else {
    cart.push({...item});
  }
  save();
  renderCart();
  showToast('Cart updated — ' + item.name);
}

/* Init render */
renderCart();

/* ---------------------------
   Wishlist toggle (delegation)
   --------------------------- */
document.body.addEventListener('click',(e)=>{
  const w = e.target.closest('[data-wish]');
  if(w){
    w.classList.toggle('text-danger');
    w.innerHTML = w.classList.contains('text-danger') ? '<i class="bi bi-heart-fill"></i>' : '<i class="bi bi-heart"></i>';
  }
});

/* ---------------------------
   Product interaction (delegation)
   --------------------------- */
const grid = document.getElementById('grid');
let lastDetailProduct = null;

grid.addEventListener('click',(e)=>{
  const card = e.target.closest('.product');
  if(!card) return;

  // Quick View button
  if(e.target.closest('[data-quick]')){
    const prod = getProductData(card);
    openQuick(prod);
    return;
  }

  // Buy Now button
  if(e.target.closest('.btn-detail')){
    const prod = getProductData(card);
    openDetail(prod);
    return;
  }

  // If clicked on card area (not a button) open detail
  if(e.target.closest('.card') && !e.target.closest('button')){
    const prod = getProductData(card);
    openDetail(prod);
    return;
  }
});

/* Enter key support to open product when focused */
grid.querySelectorAll('.product').forEach(p=>{
  p.addEventListener('keydown', (ev)=>{
    if(ev.key === 'Enter') {
      openDetail(getProductData(p));
    }
  });
});

/* Safely read dataset */
function getProductData(card){
  let thickness = [];
  try{ thickness = JSON.parse(card.dataset.thickness || '[]'); } catch(e){ thickness = []; }
  return {
    id: card.dataset.id,
    name: card.dataset.name || card.querySelector('.card-title')?.textContent || 'Product',
    img: card.dataset.img || card.querySelector('img')?.src || '',
    price: Number(card.dataset.price) || 0,
    desc: card.dataset.desc || card.querySelector('.card-title')?.textContent || '',
    thickness: thickness,
    size: card.dataset.size || ''
  };
}

/* ---------------------------
   Quick View
   --------------------------- */
const quickModal = new bootstrap.Modal(document.getElementById('quickModal'));
function openQuick(prod){
  document.getElementById('q-title').textContent = prod.name;
  document.getElementById('q-desc').textContent = prod.desc;
  document.getElementById('q-price').textContent = fmt(prod.price);
  document.getElementById('q-img').src = prod.img;
  document.getElementById('q-img').alt = prod.name;

  // attach add handler
  document.getElementById('q-add').onclick = ()=> {
    addToCart({id:prod.id, name:prod.name, price:prod.price, img:prod.img, size: prod.size || 'Queen', thickness: prod.thickness[0]||0});
    quickModal.hide();
  };
  document.getElementById('q-view').onclick = ()=> { quickModal.hide(); openDetail(prod); };
  quickModal.show();
}

/* ---------------------------
   Detail modal
   --------------------------- */
const detailModalEl = document.getElementById('detailModal');
const detailModal = new bootstrap.Modal(detailModalEl);

function openDetail(prod){
  lastDetailProduct = prod;
  document.getElementById('d-title').textContent = prod.name;
  document.getElementById('d-name').textContent = prod.name;
  document.getElementById('d-img').src = prod.img;
  document.getElementById('d-img').alt = prod.name;
  document.getElementById('d-desc').textContent = prod.desc;
  document.getElementById('d-price').textContent = fmt(prod.price);

  // thickness options
  const tSel = document.getElementById('d-thickness');
  tSel.innerHTML = '';
  (prod.thickness || []).forEach(t=>{
    const opt = document.createElement('option'); opt.value = t; opt.textContent = t + ' cm';
    tSel.appendChild(opt);
  });
  if(!tSel.children.length){
    const opt = document.createElement('option'); opt.value = ''; opt.textContent = 'Standard';
    tSel.appendChild(opt);
  }

  // size
  const sizeSel = document.getElementById('d-size');
  if(prod.size) {
    // try to set to product size, else keep default
    for(const o of Array.from(sizeSel.options)) {
      if(o.value.toLowerCase() === prod.size.toLowerCase()) { sizeSel.value = o.value; break; }
    }
  }

  // quantity controls
  const qtyInput = document.getElementById('d-qty');
  qtyInput.value = 1;
  document.getElementById('d-qty-minus').onclick = ()=> { qtyInput.value = Math.max(1, Number(qtyInput.value)-1); };
  document.getElementById('d-qty-plus').onclick = ()=> { qtyInput.value = Math.max(1, Number(qtyInput.value)+1); };

  // add handlers
  document.getElementById('d-add').onclick = ()=>{
    const item = {
      id: prod.id,
      name: prod.name,
      price: prod.price,
      img: prod.img,
      size: document.getElementById('d-size').value,
      thickness: document.getElementById('d-thickness').value,
      qty: Number(document.getElementById('d-qty').value)
    };
    addToCart(item);
    detailModal.hide();
  };
  document.getElementById('d-buy').onclick = ()=>{
    const item = {
      id: prod.id,
      name: prod.name,
      price: prod.price,
      img: prod.img,
      size: document.getElementById('d-size').value,
      thickness: document.getElementById('d-thickness').value,
      qty: Number(document.getElementById('d-qty').value)
    };
    // open checkout modal prefilled with this single item
    openCheckout([item]);
    detailModal.hide();
  };

  detailModal.show();
}

/* ---------------------------
   Filters & Sorting & Search
   --------------------------- */
function applyFilters(){
  const size = document.getElementById('filter-size').value;
  const firm = document.getElementById('filter-firm').value;
  const q = document.getElementById('search').value.toLowerCase();
  const sort = document.getElementById('sort').value;

  let cards = [...grid.querySelectorAll('.product')];
  cards.forEach(c=>{
    const title = c.querySelector('.card-title')?.textContent.toLowerCase() || '';
    const ok = (!size||c.dataset.size===size) && (!firm||c.dataset.firm===firm) && (title.includes(q));
    c.style.display = ok ? '' : 'none';
  });

  // sort visible
  cards = cards.filter(c=>c.style.display!=='none');
  cards.sort((a,b)=>{
    const pa = Number(a.dataset.price), pb = Number(b.dataset.price);
    if(sort==='low') return pa-pb;
    if(sort==='high') return pb-pa;
    return 0;
  }).forEach(c=>grid.appendChild(c));
}
['filter-size','filter-firm','search','sort'].forEach(id=>{
  const el = document.getElementById(id);
  if(el) el.addEventListener('input', applyFilters);
});

/* ---------------------------
   Counters (IntersectionObserver)
   --------------------------- */
const obs = new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      const el = entry.target;
      const target = Number(el.dataset.target) || 0;
      let cur = 0; const step = Math.max(1, Math.floor(target/120));
      const iv = setInterval(()=>{ cur+=step; if(cur>=target){ cur=target; clearInterval(iv);} el.textContent = cur.toLocaleString('en-IN'); }, 16);
      obs.unobserve(el);
    }
  })
},{threshold:0.4});
for(const c of document.querySelectorAll('.counter')) obs.observe(c);

/* ---------------------------
   Cart Events (plus/minus/delete)
   --------------------------- */
const cartList = document.getElementById('cart-items');
cartList.addEventListener('click',(e)=>{
  const minus = e.target.closest('[data-minus]');
  const plus = e.target.closest('[data-plus]');
  const del = e.target.closest('[data-del]');
  if(minus){ const i = Number(minus.dataset.minus); if(cart[i]){ cart[i].qty = Math.max(1, cart[i].qty-1); save(); renderCart(); } }
  if(plus){ const i = Number(plus.dataset.plus); if(cart[i]){ cart[i].qty += 1; save(); renderCart(); } }
  if(del){ const i = Number(del.dataset.del); cart.splice(i,1); save(); renderCart(); }
});

/* ---------------------------
   Checkout logic
   --------------------------- */
let _checkout_items = [];
let _checkout_from_cart = false;
const checkoutModal = new bootstrap.Modal(document.getElementById('checkoutModal'));

function openCheckout(items){
  // items: array of order items (if empty -> use cart)
  const orderItems = items && items.length ? items : (cart.length ? cart.slice() : []);
  _checkout_items = orderItems;
  _checkout_from_cart = !(items && items.length); // true if opened using cart (no items passed)
  const list = document.getElementById('checkout-items');
  list.innerHTML = '';
  let total = 0;
  orderItems.forEach((it, idx)=>{
    total += it.price * (it.qty||1);
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between align-items-center';
    li.innerHTML = `<div><div class="fw-semibold">${it.name}</div><small class="text-muted">${it.size || ''} • ${it.thickness || ''} • Qty: ${it.qty||1}</small></div><div class="fw-bold">${fmt(it.price * (it.qty||1))}</div>`;
    list.appendChild(li);
  });
  document.getElementById('checkout-total').textContent = fmt(total);
  checkoutModal.show();
}

/* offcanvas "Checkout" button: open checkout only if cart not empty */
document.getElementById('checkout-button').addEventListener('click', (e)=>{
  if(cart.length===0){
    e.preventDefault();
    alert('Cart empty है — पहले कुछ add करें।');
    return;
  }
  openCheckout(); // uses cart
});

/* Pay Now / Place COD */
document.getElementById('pay-now').addEventListener('click', async ()=>{
  // simple validation
  const first = document.getElementById('c-first').value.trim();
  const phone = document.getElementById('c-phone').value.trim();
  if(!first || !phone){ alert('कृपया नाम और फोन भरें'); return; }
  // simulate payment
  const payBtn = document.getElementById('pay-now');
  payBtn.disabled = true;
  const orig = payBtn.textContent;
  payBtn.textContent = 'Processing...';
  await new Promise(r=>setTimeout(r,1000));
  payBtn.disabled = false;
  payBtn.textContent = orig;
  // success — clear cart if order was from cart
  if(_checkout_from_cart){
    cart = []; save(); renderCart();
  }
  checkoutModal.hide();
  showToast('Payment successful — Order placed!');
});

document.getElementById('place-cod').addEventListener('click', ()=>{
  const first = document.getElementById('c-first').value.trim();
  const phone = document.getElementById('c-phone').value.trim();
  if(!first || !phone){ alert('कृपया नाम और फोन भरें'); return; }
  if(_checkout_from_cart){
    cart = []; save(); renderCart();
  }
  checkoutModal.hide();
  showToast('Order placed (COD). Our team will contact you.');
});

/* ---------------------------
   Year & State list & Pincode lookup
   --------------------------- */
document.getElementById('year').textContent = new Date().getFullYear();

const states = [
  "Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana",
  "Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya",
  "Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"
];
const stateSel = document.getElementById('addr-state');
states.forEach(s=>{ const opt = document.createElement('option'); opt.value = s; opt.textContent = s; stateSel.appendChild(opt); });

document.getElementById('pincode-lookup').addEventListener('click', async ()=>{
  const pincode = document.getElementById('addr-pincode').value.trim();
  if(!/^\d{6}$/.test(pincode)){ alert('कृपया 6 अंकों का सही पिनकोड डालें'); return; }
  try{
    const res = await fetch('https://api.postalpincode.in/pincode/' + pincode);
    const data = await res.json();
    if(Array.isArray(data) && data[0] && data[0].Status === 'Success' && data[0].PostOffice && data[0].PostOffice.length){
      const po = data[0].PostOffice[0];
      document.getElementById('addr-city').value = po.District || '';
      const state = po.State || '';
      if(state){
        const match = states.find(s => s.toLowerCase() === state.toLowerCase());
        if(match) stateSel.value = match;
        else {
          const partial = states.find(s => state.toLowerCase().includes(s.split(' ')[0].toLowerCase()));
          if(partial) stateSel.value = partial;
          else {
            // add received state as a non-persistent option if not found
            let newOpt = Array.from(stateSel.options).find(o=>o.value.toLowerCase()===state.toLowerCase());
            if(!newOpt){
              const o = document.createElement('option'); o.value = state; o.textContent = state; stateSel.appendChild(o); stateSel.value = state;
            } else stateSel.value = newOpt.value;
          }
        }
      }
      document.getElementById('addr-state-code').value = po.StateCode || '';
      showToast('Pincode से address मिला और auto-filled किया।');
    } else {
      alert('Pincode के लिए कोई जानकारी नहीं मिली।');
    }
  } catch(err){
    console.error(err);
    alert('Pincode lookup में समस्या आई। कृपया बाद में कोशिश करें।');
  }
});

/* ---------------------------
   Accessibility small touches
   --------------------------- */
/* Make product cards focusable already set via tabindex and role */

/* ---------------------------
   Initial filter apply
   --------------------------- */
applyFilters();

</script>
</body>
</html>


